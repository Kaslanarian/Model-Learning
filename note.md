[toc]

## 层次分析

==解决评价类问题==，可用打分解决，因素`<->`权重

|           | 指标权重 | 方案1 | 方案2 | ...  |
| --------- | -------- | ----- | ----- | ---- |
| **指标1** |          |       |       |      |
| **指标2** |          |       |       |      |
| **...**   |          |       |       |      |
|           |          |       |       |      |

$\sum w_i=1$，同一指标各方案权重和为1

#### 用分治法考虑指标权重

指标两两比较，最后形成完整的权重；

```pseudocode
function Compare(A, B): /*A，B为两指标*/
if Compare(B, A)已知:
	return 1/Compare(B, A)
elseif A和B同等重要:
	return 1
elseif A比B稍微重要：
	return 3
elseif A比B明显重要：
	return 5
elseif A比B强烈重要：
	return 7
elseif A比B极端重要：
	return 9
```

|           | 指标1 | 指标2 | 指标3 |
| --------- | ----- | ----- | ----- |
| **指标**1 | 1     | 2     | 5     |
| **指标**2 | 1/2   | 1     | 1/4   |
| **指标**3 | 1/5   | 4     | 1     |

判断矩阵中$A_{ij}$就是$i$相对于$j$的重要程度，同样可以有：

| 指标X     | 方案1     | 方案2 |
| --------- | --------- | ----- |
| **方案1** | 1         | 3     |
| **方案2** | $\frac13$ | 1     |

此时存在矛盾现象（不一致）

应总有：
$$
a_{ij}a_{jk}=a_{ik}\leftrightarrow 各行各列成比例\leftrightarrow A是一致矩阵\leftrightarrow rank(A)=1,\lambda_1=tr(A)=n,\lambda_i=0(i>1)
$$
一致性指标：$CI=\dfrac{\lambda_{max}-n}{n-1}$，平均随机一致性指标$RI$（查表），判断矩阵的一致性比例$CR=\dfrac{CI}{RI}<0.1$才可以接受，否则要修正。

对于不一致的判断矩阵，不能只对第一列归一化，而是分别计算各列的权重，并将对应算术(==或集合==)平均作为真实权重：
$$
\omega_i=\dfrac1n\sum_{j=1}^n\dfrac{a_{ij}}{\sum_{k=1}^na_{kj}},i=1,2,\cdots,n
$$
**特征值法**：求最大特征值对应的特征向量进行归一化就是各项权重（使用最多）

 ## 优劣解距离法(TOPSIS)

若只有一个指标：构造计算评分的公式：
$$
f(x)=\dfrac{x-min}{max-min}
$$
指标分为极大型指标（效益性指标）和极小型指标（成本性指标）；对极小型指标要进行==指标正向化==：
$$
f(x)=max-x
$$
量纲不同需要标准化处理：$n$个要评价的对象，$m$个指标（已经正向化）
$$
X=\begin{bmatrix}
x_{11}&x_{12}&\cdots x_{1m}\\
x_{21}&\cdots\\
\vdots\\
x_{n1}
\end{bmatrix}\longrightarrow Z:z_{ij}=\dfrac{x_{ij}}{\sqrt{\sum_{i=1}^nx_{ij}^2}}
$$

```matlab
matlab : repmat函数
```

若$Z$是已经标准化处理后的数据矩阵：定义第$i$个评价对象与最大值的距离：

```matlab
D_max = norm(Z(i) - max(Z))
```

最小值类似：

```matlab
D_min = norm(Z(i) - min(Z))
```

从而有未归一化的得分：$S_i=\dfrac{D_{min}}{D_{max}+D_{min}}$

事实上还有两种指标：中间型指标(PH值)，区间型指标(体温)

中间型指标正向化：
$$
M=max\{|x_i-x_{best}|\},\tilde{x}_i=1-\dfrac{|x_i-x_{best}|}{M}
$$
区间型指标正向化：最佳区间为$[a,b]$:
$$
M=\max\{a-\min\{x_i\},\max\{x_i\}-b\}\\
\tilde x_i=
\begin{cases}
1-\dfrac{a-x}{M},x<a  \\
1,a\le x\le b\\
1-\dfrac{x-b}M,x>b
\end{cases}
$$
步骤：正向化$\to$标准化$\to$计算得分并归一化

#### 基于熵权法对`Topsis`模型的修正

熵权法是一种客观赋权的方法，依据的原理：==指标的变异程度越小，所反映的信息量就越少，其对应的权值也应该越低。==（客观=数据本身就可以告诉我们权重）

> 越有可能发生的事情，信息量月少；反之信息量越多

信息熵：$x$为事情发生的情况，$p(x)$为概率，定义
$$
\begin{aligned}
I(x)&=-\ln(p(x))\\
H(x)&=\sum_{i=1}^n[p(x_i)I(x_i)]=-\sum_{i=1}^n[p(x_i)\ln p(x_i)]
\end{aligned}
$$
信息熵是对信息量的期望值。信息熵越大，<u>已知</u>信息量越小

计算方法：给定已正向化矩阵$X_{n\times m}$，标准化后为$Z$，再计算概率矩阵$P$:
$$
p_{ij}=\dfrac{z_{ij}}{\sum_{i=1}^n z_{ij}}
$$
再算信息熵和信息效用值：对第$j$个指标而言，其信息熵计算公式为：
$$
e_j=-\dfrac1{\ln n}\sum_{i=1}^np_{ij}\ln(p_{ij}),j=1,2,\cdots,m\\
信息效用值d_j=1-e_j
$$
将信息效用值归一化，得到每个指标的熵权：$W_j=d_j/\sum d$

## 插值算法

1. 分段多项式作为插值函数：分段差值；
2. 一个多项式插值：多项式插值；
3. $P(x)$是三角多项式：三角插值（很少用）

**定理**：$n+1$个互不相同的节点存在唯一$n$次多项式插值。

**$Runge$现象**：高次插值产生极大波动和明显震荡，所以不应轻易使用高次插值

分段低次插值可以提高插值精度（分段线性插值，分段二次插值）

牛顿插值、拉格朗日插值都存在龙格现象，因此用得少；

埃尔米特插值：具有节点的导数值约束的插值. In matlab : `y_new = pchip(x, y, x_new)`

三次样条插值：更加严格插值:MATLAB `p = spline(x, y, new_x)`

#### $n$维数据的插值

优先使用`spline`: `p = interpn(x, y, x_new, 'spline')`

## 拟合算法

最小二乘法公式：
$$
\hat k=\dfrac{n\sum x_iy_i-\sum y\sum x}{n\sum x^2-\sum x\sum x}\\
\hat b=\dfrac{\sum x^2\sum y-\sum x\sum xy}{n\sum x^2-\sum x\sum x}
$$
判断拟合好坏：

1. 总体平方和$SST$：$SST=\sum_{i=1}^n(y_i-\bar y)^2$
2. 误差平方和$SSE$：$SSE=\sum_{i=1}^n(y_i-\hat y_i)^2$
3. 回归平方和$SSR$：$SSR=\sum_{i=1}^n(\hat y_i-\bar y)^2$

我们有:
$$
SST=SSE+SSR
$$

4. 拟合优度：$0\le R^2=\dfrac{SSR}{SST}=\dfrac{SST-SSE}{SST}\le 1$

$R^2$越接近1，拟合越好，==$R^2$只能用于拟合函数是线性函数的时候==，线性函数和其他非线性函数比较拟合好坏可以直接看$SSE$

==此处的线性函数为对参数为线性（线性于参数）==，比如$y=a_1+a_2x+a_3x^2,y=e^{a_1+a_2x},y=a_1+a_2x+a_3x^2+a_4x^3$.

非线性：$y=a+b^3x,y=a+bx+bcx^2,y=a(x-b)^2,y=a\sin(b+cx)$，都不能用$R^2$

## 相关系数

总体协方差：
$$
Cov(X,Y)=\dfrac{\sum_{i=1}^n(X_i-E(X))(Y_i-E(Y))}n
$$
==协方差的大小和两个变量的量纲有关，不适合作比较==，因此规范化：
$$
\rho_{XY}=\dfrac{Cov(X,Y)}{\sigma_X\sigma_Y}=\dfrac1n\sum_{i=1}^n\dfrac{X_i-E(X)}{\sigma_X}\dfrac{Y_i-E(Y)}{\sigma_Y}
$$
总体皮尔逊相关系数是标准化后的协方差。

样本协方差：
$$
Cov(X,Y)=\dfrac{\sum_{i=1}^n(X_i-E(X))(Y_i-E(Y))}{n-1}
$$
样本皮尔逊相关系数:
$$
r_{XY}=\dfrac{Cov(X,Y)}{S_XS_Y}
$$
误区：皮尔逊系数是衡量两随机变量线性相关的程度，而非线性关系也能导致线性相关系数很大。

相关系数会受到异常值的影响。 

<u>对数据进行描述性统计</u>是好的统计习惯，SPSS上操作：`分析->描述统计->描述`

`图形->旧对话框->散点图->矩阵散点图`刻画出两两变量的联系。

#### 皮尔逊相关系数假设检验

构造统计量：
$$
t=r\sqrt{\dfrac{n-2}{1-r^2}}
$$
自由度为$n-2$的$t$分布，然后找接受域和拒绝域；

显著性标记：$P<0.01$标三颗星，$P>0.01 \&P<0.05$标两个星，$P<0.1\&P>0.05$标一颗星

在$SPSS$中：`分析->相关->双变量->标记显著相关性`

皮尔逊相关系数假设检验的条件：实验数据来自正态分布的总体，实验数据差距不能太大，抽样独立。

#### 检验正态分布

##### JB检验(n大于30)

构造JB统计量:
$$
JB=\dfrac n6[S^2+\dfrac{(K-3)^2}{4}]\sim\chi(2)
$$
$S$是偏度(`skewness`)，$K$是峰度`kurtosis`：
$$
S=E[(\dfrac{X-\mu}{\sigma})^3]\\K=E[(\dfrac{X-\mu}{\sigma})^4](-3)
$$
对$JB$假设检验得到检验值$JB^*$，计算其$p$值，如果$<0.05$则拒绝原假设。

```matlab
[h, p] = jbtest(data(:, 1), 0.05) 
% 检验第一列数据是否为正态分布，h=1则拒绝原假设，=0则接受，0.05表示显著性水平
```

##### 夏丕罗-威尔克检验(小样本)

$SPSS$:`分析->描述统计->探索->图->含检验的正态图`

##### Q-Q图

判断近似正态分布`<->`Q-Q图上的点近似一条直线。matlab里用`qqplot(data)`

